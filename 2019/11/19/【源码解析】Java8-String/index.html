<!DOCTYPE html>
<html lang="cn">
<head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">

<!--ＪQuery-->
<script src="/Module/JQuery/jquery.min.js"></script>

<!--Vue.js-->
<script src="/Module/vue/vue.js"></script>
<!--饿了么Ｕi-->
<link rel="stylesheet" href="/Module/ElementUi/css/index.css">
<script src="/Module/ElementUi/index.js"></script>

<!--highlight-->
<link rel="stylesheet" href="/Module/highlight/css/zenburn.css">
<script src="/Module/highlight/highlight.min.js"></script>

<!--axios-->
<script src="/Module/axios/axios.min.js"></script>

<!--评论-->
<script src="/Module/comment/valine/Valine.min.js"></script>

<!--主题样式-->
<link rel="stylesheet" href="/Module/style.css">

<!--设置页面描述与关键字,封面图片-->

    <meta name="description" content="String源码解析" />
    <meta name="keywords" content="" />
    <title>【源码解析】Java8-String</title>
    
    <style>
        #content #title {
            background-image: url('/background.jpg');
        }
    </style>
    

</head>
<body>
    <div id="app" v-cloak>
    <div id="content">
        <el-button type="text" id="nav" icon="el-icon-tickets" @click="visible = !visible"></el-button>
<el-dialog :visible.sync="visible"  title="前往">
    <el-input id="searchInput" v-model="input" placeholder="请输入内容"></el-input>
    <div id="searchResult"></div>

    <br>
    <div id="Menu">
      <div class="grid-content bg-purple"><el-button><el-link :underline="false" href="/">首页</el-link></el-button></div>
      <div class="grid-content bg-purple"><el-button><el-link :underline="false" href="/archive/">归档</el-link></el-button></div>
      <div class="grid-content bg-purple"><el-button><el-link :underline="false" href="/about/">关于</el-link></el-button></div>
      <div class="grid-content bg-purple"><el-button><el-link :underline="false" href="/ly/">留言</el-link></el-button></div>
      <div class="grid-content bg-purple"><el-button><el-link :underline="false" href="/categories/">分类</el-link></el-button></div>
      <div class="grid-content bg-purple"><el-button><el-link :underline="false" href="/tages/">标签</el-link></el-button></div>
    </div>

</el-dialog>

<el-link href="#top"  id="toTop" class="show" :underline="false" icon="el-icon-top" ></el-link>



        
        <div id="title">
            <h1>
                【源码解析】Java8-String<br>
                
                <p>作者：wz<br>编写：2019-11-19</p>
            </h1>
        </div>
        

        <div id="article">
            <p><meta name="referrer" content="no-referrer"></p>
<ul>
<li><h4 id="String是Immutable（不可变的）"><a href="#String是Immutable（不可变的）" class="headerlink" title="String是Immutable（不可变的）"></a>String是Immutable（不可变的）</h4><ol>
<li><p>String源码及分析：</p>
<p>类定义：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">String</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<p>变量定义：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** The value is used for character storage. */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">char</span> value[];</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Cache the hash code for the string */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> hash; <span class="comment">// Default to 0</span></span><br></pre></td></tr></table></figure>
<p>hashCode计算：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> h = hash;</span><br><span class="line">        <span class="keyword">if</span> (h == <span class="number">0</span> &amp;&amp; value.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">char</span> val[] = value;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; value.length; i++) &#123;</span><br><span class="line">                h = <span class="number">31</span> * h + val[i];</span><br><span class="line">            &#125;</span><br><span class="line">            hash = h;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> h;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>由源码可以看出hash值初始化时是0，当获取过一次之后hashCode就会被计算出来，然后被缓存了下来，随String一块不再变了，也正是因为此，喜欢吧String作为HashMap的key</p>
<p>hashCode计算有个问题：为什么需要一个中间变量h ？</p>
<p>答：没有临时变量是线程不安全的，因为多线程访问下，如果没有h，当一个线程进行计算时，第二个线程进来，此时hash不为0则直接返回此时错误的值。</p>
<p>String保持不可变性采取了哪些措施？</p>
<ul>
<li>value[] 使用 private final 修饰</li>
</ul>
</li>
</ol>
<ul>
<li>构造函数中复制实参的值给 value[]<ul>
<li>不对外提供任何修改 value[] 值的方法</li>
</ul>
</li>
<li>需要返回 String 的方法，绝不返回原对象，都是重新 new 一个 String 返回</li>
</ul>
</li>
</ul>
<ol start="2">
<li><p>String对象的创建</p>
<p>String Pool（字符串池）：</p>
<ul>
<li><p>定义：Java为String提供了特殊的存储机制，叫String intern pool，全局共享的，存储的是队中字符串实例的引用而不是存储实例本身，在方法区</p>
</li>
<li><p>哪些对象会放在：1.字面值字符串 2.字符串赋值常量表达式3.使用intern方法对String对象操作返回的String对象</p>
<p>举栗子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  String st1 = <span class="string">"yveshe1"</span>;</span><br><span class="line">String st2 = <span class="keyword">new</span> String(<span class="string">"yveshe2"</span>);</span><br><span class="line">String st3 = <span class="string">"a"</span>+<span class="string">"b"</span>;</span><br><span class="line">String st = st1 + <span class="string">"hello"</span>;</span><br><span class="line">  String internStr = st.intern();</span><br><span class="line">System.out.println(st == internStr);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">1. 字面值字符串有：yveshe2，hello,a,b</span><br><span class="line">  2. 字符串赋值表达式：st1 = &quot;yveshe1&quot; ,st3 = &quot;a&quot;+&quot;b&quot;;</span><br><span class="line">3. 使用intern方法的有：st1 = yveshe1hello</span><br><span class="line"></span><br><span class="line">  ​    其中st1在常量池 ，st2不在常量池 ，st3在常量池，st不在常量池</span><br><span class="line"></span><br><span class="line">​	internStr1.6之前在常量池，1.6之后使用的st的实际地址，只在常量池中保存了引用</span><br><span class="line"></span><br><span class="line">String对象的创建：</span><br><span class="line"></span><br><span class="line">1. String s1 = &quot;aaaa&quot;;</span><br><span class="line"></span><br><span class="line">   Java虚拟机首先在字符串池中查找是否存在值为”aaaa“这个对象，如果有则不再创建新的对象，直接返回已存在的对象的引用；如果没有则先创建这个对象，放在字符串池中，再将它引用返回</span><br><span class="line"></span><br><span class="line">2. String s1 = new String(&quot;aaaa&quot;);</span><br><span class="line"></span><br><span class="line">   创建了两个对象，一个是字面量aaaa创建的String对象，在String Pool中，另外一个是new产生的String对象，在Java Heap中</span><br><span class="line"></span><br><span class="line">3. 使用+操作符号创建String对象</span><br><span class="line"></span><br><span class="line">   - String s1 = &quot;yves&quot; + &quot;he&quot;;</span><br><span class="line">     System.out.println(s1 == &quot;yveshe&quot;); </span><br><span class="line"></span><br><span class="line">     编译会变成String s1 = &quot;yveshe&quot;</span><br><span class="line"></span><br><span class="line">   - String s1 = &quot;yves&quot;;</span><br><span class="line">     String s2 = s1 + &quot;he&quot;;</span><br><span class="line">     System.out.println(s2 == &quot;yveshe&quot;);</span><br><span class="line"></span><br><span class="line">     编译成如下：</span><br><span class="line"></span><br><span class="line">     String s1 = &quot;yves&quot;;</span><br><span class="line">     String s2 = (new StringBuilder(String.valueOf(s1))).append(&quot;he&quot;).toString();</span><br><span class="line">     System.out.println(s2 == &quot;yveshe&quot;); </span><br><span class="line"></span><br><span class="line">4. intern()方法的用途</span><br><span class="line"></span><br><span class="line">   String s = new String(&quot;YvesHe&quot;).intern();</span><br><span class="line">   System.out.println(s == &quot;YvesHe&quot;);</span><br><span class="line"></span><br><span class="line">   结果为true</span><br><span class="line"></span><br><span class="line">   作用有两个，1. 把字符串字面量放入常量池 2. 返回常量的引用</span><br><span class="line">   </span><br><span class="line">5. String.ValueOf和Integer.toString和“”+i</span><br><span class="line"></span><br><span class="line">   前两个没啥区别，最后会new 一个String</span><br></pre></td></tr></table></figure>
<p>参考：<a href="https://juejin.im/post/5ca5c51451882544114cdc95" target="_blank" rel="noopener">https://juejin.im/post/5ca5c51451882544114cdc95</a></p>
<p><a href="https://blog.csdn.net/u011479200/article/details/83384215" target="_blank" rel="noopener">https://blog.csdn.net/u011479200/article/details/83384215</a></p>
<p><a href="https://www.cnblogs.com/fangfuhai/p/5500065.html" target="_blank" rel="noopener">https://www.cnblogs.com/fangfuhai/p/5500065.html</a></p>
</li>
</ol>
   
            <br>
            <hr><br>
            
                <div id="article-previous">
                    <a href="/2019/11/19/【源码解析】Java8-StringBuild和StringBuffer/" data-toggle="tooltip" data-placement="top" title="【源码解析】Java8-StringBuild和StringBuffer">&larr; 上一篇</a>
                </div>
                
                
                <div id="article-next">
                    <a href="/2019/11/19/【源码解析】Java8-LinkList/" data-toggle="tooltip" data-placement="top" title="【源码解析】Java8-LinkList">下一篇 &rarr;</a>
                </div>
            
            <br><br>
            <hr>
        </div>
    </div>

    <div id="comment">
        
        
    <h2>留言</h2>
    <div id="vcomments">
    </div>
    <script>
        var valine = new Valine({
        el: '#vcomments', 
        appId: 'HfM9lGHkjvrCY4Y00sfk4TbY-gzGzoHsz',
        appKey: 'yzGGVla3JWB1CeQ6dIECEGVc',
    
        emojiCDN: 'https://i0.hdslb.com/bfs/emote/', 
        emojiMaps: {
          "tv_doge": "6ea59c827c414b4a2955fe79e0f6fd3dcd515e24.png",
          "tv_亲亲": "a8111ad55953ef5e3be3327ef94eb4a39d535d06.png",
          "tv_偷笑": "bb690d4107620f1c15cff29509db529a73aee261.png",
          "tv_再见": "180129b8ea851044ce71caf55cc8ce44bd4a4fc8.png",
          "tv_冷漠": "b9cbc755c2b3ee43be07ca13de84e5b699a3f101.png",
          "tv_发怒": "34ba3cd204d5b05fec70ce08fa9fa0dd612409ff.png",
          "tv_发财": "34db290afd2963723c6eb3c4560667db7253a21a.png",
          "tv_可爱": "9e55fd9b500ac4b96613539f1ce2f9499e314ed9.png",
          "tv_吐血": "09dd16a7aa59b77baa1155d47484409624470c77.png",
          "tv_呆": "fe1179ebaa191569b0d31cecafe7a2cd1c951c9d.png",
          "tv_呕吐": "9f996894a39e282ccf5e66856af49483f81870f3.png",
          "tv_困": "241ee304e44c0af029adceb294399391e4737ef2.png",
          "tv_坏笑": "1f0b87f731a671079842116e0991c91c2c88645a.png",
          "tv_大佬": "093c1e2c490161aca397afc45573c877cdead616.png",
          "tv_大哭": "23269aeb35f99daee28dda129676f6e9ea87934f.png",
          "tv_委屈": "d04dba7b5465779e9755d2ab6f0a897b9b33bb77.png",
          "tv_害羞": "a37683fb5642fa3ddfc7f4e5525fd13e42a2bdb1.png",
          "tv_尴尬": "7cfa62dafc59798a3d3fb262d421eeeff166cfa4.png",
          "tv_微笑": "70dc5c7b56f93eb61bddba11e28fb1d18fddcd4c.png",
          "tv_思考": "90cf159733e558137ed20aa04d09964436f618a1.png",
          "tv_惊吓": "0d15c7e2ee58e935adc6a7193ee042388adc22af.png",
        }
    })
    </script>

    
    
    
     
    </div>
</div>
    <script src="/Module/main.js"></script>
</body>
</html>